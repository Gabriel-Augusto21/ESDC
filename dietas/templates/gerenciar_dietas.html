{% extends 'master.html' %} {% load static %} {% block conteudo %}{% load custom_tags %}

<div class="container mt-3">
    <h1>Gerenciamento da Dieta</h1>

    <!-- Cards dos animais -->
    <div class="d-flex justify-content-center align-items-center gap-3 mb-4 flex-wrap">
        <div class="card shadow-sm" style="width: 180px; border-radius: 15px">
            <img src="{% static 'img/cavalo1.png' %}" class="card-img-top" style="border-radius: 15px 15px 0 0" />
            <div class="card-body text-center">
                <h6 class="card-title mb-1">Animal 1</h6>
                <small class="text-muted">Proprietario</small>
            </div>
        </div>

        <div class="card shadow-sm" style="width: 180px; border-radius: 15px">
            <img src="{% static 'img/cavalo2.png' %}" class="card-img-top" style="border-radius: 15px 15px 0 0" />
            <div class="card-body text-center">
                <h6 class="card-title mb-1">Animal 2</h6>
                <small class="text-muted">Proprietario</small>
            </div>
        </div>
    </div>

    <h1>Dieta: {{ dieta.nome }}</h1>

    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead class="table-light">
                <tr>
                    <th>Alimento</th>
                    <th>Quantidade</th>
                    <th style="white-space: nowrap;">MS <small>(%)</small></th>
                    <th style="white-space: nowrap;">PB <small>(Mcal)</small></th>
                    <th style="white-space: nowrap;">ED <small>(%MS)</small></th>
                    {% for nutriente in todos_nutrientes %}
                    <th style="white-space: nowrap;">
                        {{ nutriente.nome }} <small>({{ nutriente.unidade }})</small>
                    </th>
                    {% endfor %}
                </tr>
            </thead>

            <tbody>
                {% for comp in comp_dieta %}
                <tr>
                    <td style="white-space: nowrap;">{{ comp.alimento.nome }}</td>
                    <td>{{ comp.quantidade|truncar:2 }} <small>(kg)</small></td>
                    <td>{{ comp.alimento.ms }}</td>
                    <td>{{ comp.alimento.pb }}</td>
                    <td>{{ comp.alimento.ed }}</td>

                    {% for nutriente in todos_nutrientes %}
                    <td>
                        {{ nutrientes_por_alimento|dictget:comp.alimento.id|dictget:nutriente.id|default:0 }}
                    </td>
                    {% endfor %}
                </tr>
                {% empty %}
                <tr>
                    <td colspan="{{ 5|add:todos_nutrientes|length }}">Nenhum alimento nesta dieta.</td>
                </tr>
                {% endfor %}

                <!-- Linha de total fornecido -->
                <tr class="table-info fw-bold">
                    <td colspan="5" class="text-end">Total Fornecido:</td>
                    {% for nutriente in todos_nutrientes %}
                    <td>
                        {{ total_fornecido|dictget:nutriente.nome|default:"0" }}
                    </td>
                    {% endfor %}
                </tr>

                <!-- Linha da Exigência -->
                <tr class="table-warning fw-bold">
                    <td colspan="5" class="text-end">Exigência:</td>
                    {% for nutriente in todos_nutrientes %}
                    <td>
                        {{ exigencia_por_nutriente|dictget:nutriente.nome|default:"0" }}
                    </td>
                    {% endfor %}
                </tr>

                <!-- Linha de balanceamento -->
                <tr class="table-secondary">
                    <td colspan="5" class="text-end">Balanceamento (Diferença p/ Exigência):</td>
                    {% for nutriente in todos_nutrientes %}
                    <td>
                        {{ balanceamento|dictget:nutriente.nome|default:"0" }}
                    </td>
                    {% endfor %}
                </tr>


            </tbody>

        </table>

    </div>


    {% comment %}
    <!-- Seção Balanceamento -->
    <h5 class="mb-3">Balanceamento da dieta</h5>
    <div class="table-responsive">
        <table class="table text-center align-middle">
            <thead class="table-light">
                <tr>
                    <th>Nome alimentos_nutrientes</th>
                    <th>Ord. MN</th>
                    <th>MS (kg)</th>
                    <th>ED (Mcal)</th>
                    <th>PB (g)</th>
                    <th>Lis (g)</th>
                    <th>Treon (g)</th>
                    <th>Met (g)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                </tr>
                <tr style="color: white">
                    <td colspan="2" style="background-color: #2f453a">
                        Total fornecido dieta
                    </td>
                    <td colspan="1" style="background-color: #2f453a">aaaaa</td>
                    <td colspan="1" style="background-color: #2f453a"></td>
                </tr>
                <tr class="table-success">
                    <td colspan="8">-</td>
                </tr>
                <tr class="table-secondary fw-bold">
                    <td colspan="8">Exigência animal</td>
                </tr>
                <tr class="table-secondary">
                    <td colspan="8">-</td>
                </tr>
                <tr class="table-dark text-white fw-bold">
                    <td colspan="8">Balanceamento</td>
                </tr>
                <tr class="table-dark text-white">
                    <td colspan="8">MS | ED | PB | Lis | Treo</td>
                </tr>
            </tbody>
        </table>
    </div>
    {% endcomment %}

    <!-- Botões -->
    <div class="d-flex justify-content-end mt-3">
        <button class="btn btn-success me-2">
            <i class="bi bi-sliders"></i> Balancear Dieta
        </button>
        <button class="btn btn-primary"><i class="bi bi-save"></i> Salvar</button>
    </div>
</div>
{% endblock %}